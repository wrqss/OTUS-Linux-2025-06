### Openvpn

#### Настроить VPN между двумя ВМ в tun/tap режимах, замерить скорость в туннелях, сделать вывод об отличающихся показателях
Задача сделана без Vagrant, используются виртуальные машины развернутые на гипервизоре proxmox

С помощью ansible-playbook openvpn.yml настраивается реализация VPN через TAP. Выполнены измерения с помощью iperf3

 ```
iperf3 -c 10.10.10.1 -t 40 -i 5 -B 10.10.10.2
Connecting to host 10.10.10.1, port 5201
[  5] local 10.10.10.2 port 57967 connected to 10.10.10.1 port 5201
[ ID] Interval           Transfer     Bitrate         Retr  Cwnd
[  5]   0.00-5.00   sec   149 MBytes   249 Mbits/sec  191   83.4 KBytes
[  5]   5.00-10.00  sec   153 MBytes   256 Mbits/sec   84    292 KBytes
[  5]  10.00-15.00  sec   136 MBytes   228 Mbits/sec  255   82.1 KBytes
[  5]  15.00-20.00  sec   152 MBytes   255 Mbits/sec  142    172 KBytes
[  5]  20.00-25.00  sec   163 MBytes   273 Mbits/sec   57    221 KBytes
[  5]  25.00-30.00  sec   150 MBytes   252 Mbits/sec  208    144 KBytes
[  5]  30.00-35.00  sec   148 MBytes   248 Mbits/sec  178    248 KBytes
[  5]  35.00-40.00  sec   138 MBytes   231 Mbits/sec  215    133 KBytes
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-40.00  sec  1.16 GBytes   249 Mbits/sec  1330             sender
[  5]   0.00-40.00  sec  1.16 GBytes   249 Mbits/sec                  receiver

iperf Done.
```
Изменением строчек конфига, 
```
dev tun
ifconfig 10.10.10.2 10.10.10.1
```
Были выполнены измерения с данной конфигурацией:

```
 iperf3 -c 10.10.10.1 -t 40 -i 5 -B 10.10.10.2
Connecting to host 10.10.10.1, port 5201
[  5] local 10.10.10.2 port 57767 connected to 10.10.10.1 port 5201
[ ID] Interval           Transfer     Bitrate         Retr  Cwnd
[  5]   0.00-5.00   sec   116 MBytes   195 Mbits/sec  174   88.1 KBytes
[  5]   5.00-10.00  sec   123 MBytes   206 Mbits/sec   76    155 KBytes
[  5]  10.00-15.00  sec   123 MBytes   207 Mbits/sec   65    219 KBytes
[  5]  15.00-20.00  sec   115 MBytes   194 Mbits/sec   84   98.4 KBytes
[  5]  20.00-25.00  sec   118 MBytes   198 Mbits/sec  188    132 KBytes
[  5]  25.00-30.00  sec   118 MBytes   198 Mbits/sec  164    104 KBytes
[  5]  30.00-35.00  sec   119 MBytes   200 Mbits/sec   90    128 KBytes
[  5]  35.00-40.00  sec   121 MBytes   203 Mbits/sec  170   90.6 KBytes
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-40.00  sec   954 MBytes   200 Mbits/sec  1011             sender
[  5]   0.00-40.00  sec   952 MBytes   200 Mbits/sec                  receiver

iperf Done.
```

Вывод:  
Режим TUN  
- Работает на уровне 3 (сетевом уровне) модели OSI.  
- Передаёт только IP-пакеты (т.е. работает с маршрутизацией IP-трафика).  
- Создаётся виртуальный IP-интерфейс (обычно tun0).  
 Преимущества:  
- Меньшие накладные расходы, что позволяет эффективнее передавать IP-трафик.  
- Идеально подходит для организации VPN-маршрутизации между сетями (например, для подключения удалённых офисов).  
 Ограничения:
- Не передаёт широковещательные или мультикастовые Ethernet-пакеты, так как работает только с IP-трафиком.  

Режим TAP  
- Работает на уровне 2 (канальном уровне) модели OSI.  
- Передаёт полные Ethernet-кадры (включая информацию о MAC-адресах, протоколах и т.д.).  
- Создаётся виртуальный Ethernet-интерфейс (обычно tap0).  
Преимущества:  
- Поддерживает передачу широковещательных и мультикастовых пакетов.  
- Позволяет эмулировать локальную сеть, что удобно для приложений, требующих Ethernet-связи (например, для работы некоторых VPN-приложений или игровых серверов).  
Ограничения:  
- Больше накладных расходов за счёт передачи дополнительных данных уровня Ethernet.  
- Возможно, сложнее в настройке для маршрутизации IP-трафика, так как в первую очередь используется для мостовых соединений.  

Выбор режима  
- Для организации VPN, когда требуется передавать в основном IP-трафик и важна высокая производительность, лучше использовать режим TUN.
- Если требуется создать прозрачный мост для удалённых устройств (например, для совместного использования ресурсов локальной сети или эмуляции Ethernet-сети), выбирают режим TAP.  
Таким образом, основное различие состоит в уровне туннелирования:  
- TUN – туннелирование на сетевом уровне, подходит для IP-маршрутизации.
- TAP – туннелирование на канальном уровне, эмулирует Ethernet-сеть и поддерживает широковещательный трафик.

#### Поднять RAS на базе OpenVPN с клиентскими сертификатами

С помощью ansible-playbook openvpn_tls.yml выполняется настройка клиента и сервера с необходими сертификатами.
Подключение к серверу выполняется командой: `openvpn --config client.conf` из созданного каталога на клиентсвой ВМ

```
root@wrqs:/etc/openvpn# ping -c 4 10.10.10.1
PING 10.10.10.1 (10.10.10.1) 56(84) bytes of data.
64 bytes from 10.10.10.1: icmp_seq=1 ttl=64 time=0.037 ms
64 bytes from 10.10.10.1: icmp_seq=2 ttl=64 time=0.039 ms
64 bytes from 10.10.10.1: icmp_seq=3 ttl=64 time=0.047 ms
64 bytes from 10.10.10.1: icmp_seq=4 ttl=64 time=0.038 ms
```
